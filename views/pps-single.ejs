<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Diecasting Chart</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f4f4f4;
        padding: 20px;
      }
      #controls {
        margin-bottom: 20px;
      }
      #controls label {
        font-size: 18px;
        margin-right: 10px;
      }
      #productSelect {
        font-size: 18px;
        padding: 5px 10px;
        min-width: 120px;
      }
      #controls button {
        font-size: 16px;
        padding: 5px 10px;
        margin-left: 5px;
      }
      #chart {
        width: 100%;
        height: 600px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  </head>
  <body>
    <h1>Diecasting Eigenvalue Chart(1 Shot)</h1>
    <div id="controls">
      <label for="productSelect">Product: </label>
     <select id="productSelect">
  <% ["LL","LR","ML","MR"].forEach(p => { %>
    <option value="<%= p %>" <%= p === type ? "selected" : "" %>>
      <%= p %>
    </option>
  <% }) %>
</select>
      <button id="prevBtn">上一個</button>
      <button id="nextBtn">下一個</button>
    </div>
    <div id="chart"></div>

   <script>
  let models = <%- JSON.stringify(models) %>;
  let currentIndex = models.length > 0 ? models.length - 1 : 0;
  const chart = echarts.init(document.getElementById("chart"));

  function renderChart(model) {
    if (!model) return;
    const option = {
      title: { text: `${model.type || "N/A"} - ${model.dt}` },
      legend: { data: ["Pressure", "Position", "Speed"] },
      xAxis: { type: "category", data: model.position.map((_, i) => i + 1) },
      yAxis: { type: "value", min: 0 },
      series: [
        { name: "Pressure", type: "line", data: (model.pressure || []).map(v => v * 15) },
        { name: "Position", type: "line", data: model.position || [] },
        { name: "Speed", type: "line", data: (model.speed || []).map(v => v * 15) },
      ],
    };
    chart.setOption(option);
  }

  function updateChart() {
    if (models.length === 0) {
      chart.clear();
      chart.setOption({ title: { text: "No Data" } });
      return;
    }
    if (currentIndex >= models.length) currentIndex = models.length - 1;
    if (currentIndex < 0) currentIndex = 0;
    renderChart(models[currentIndex]);
  }

  // 🔹 切換產品時整頁 reload
  function fetchDataByType(type) {
    location.href = `/pps/single?type=${type}`;
  }

  document.getElementById("productSelect").addEventListener("change", () => {
    const type = document.getElementById("productSelect").value;
    fetchDataByType(type);
  });

  document.getElementById("prevBtn").addEventListener("click", () => {
    currentIndex--;
    updateChart();
  });
  document.getElementById("nextBtn").addEventListener("click", () => {
    currentIndex++;
    updateChart();
  });

  updateChart();
</script>
  </body>
</html>
